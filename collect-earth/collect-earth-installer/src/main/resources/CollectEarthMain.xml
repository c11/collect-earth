<component>
    <name>CollectEarthMainComponent</name>
    <description>CollectEarth</description>
    <canBeEdited>1</canBeEdited>
    <selected>1</selected>
    <show>1</show>
    <desktopShortcutList>
        <shortcut>
            <comment>Start Collect Earth</comment>
            <exec>${installdir}/CollectEarth-launcher.run</exec>
            <icon>${installdir}/launcher_logo.png</icon>
            <name>Collect Earth</name>
            <path></path>
            <platforms>all</platforms>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/CollectEarth-launcher.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon>${installdir}/launcher_icon.ico</windowsIcon>
            <windowsPath></windowsPath>
        </shortcut>
    </desktopShortcutList>
    <folderList>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfiles</name>
            <platforms>all</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/src/main/resources/images</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/resources</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/target/earth-libs</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/target/CollectEarth.jar</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/disclaimer.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/README.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/License.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/UserManual.pdf</origin>
                </distributionFile>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/resources/lucas_demo</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>earth.properties_initial</origin>
                </distributionFile>
                <distributionFile>
                    <origin>update.ini</origin>
                </distributionFile>
            </distributionFileList>
            <shortcutList>
                <shortcut>
                    <comment>Uninstall</comment>
                    <exec>${installdir}/${uninstallerName}</exec>
                    <icon></icon>
                    <name>Uninstall ${product_fullname}</name>
                    <path>${installdir}</path>
                    <platforms>all</platforms>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </shortcutList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux</name>
            <platforms>linux</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_logo.png</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.run</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows</name>
            <platforms>windows</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_icon.ico</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.exe</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilesosx</name>
            <platforms>osx</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_icon.icns</origin>
                </distributionFile>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.app</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
    </folderList>
    <initializationActionList>
        <setInstallerVariable>
            <name>java_launcher_jar</name>
            <progressText>Creating Launcher</progressText>
            <value>CollectEarth.jar</value>
        </setInstallerVariable>
    </initializationActionList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${env(SYSTEMDRIVE)}/OpenForis/${product_shortname}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
        </directoryParameter>
    </parameterList>
    <postBuildActionList>
        <!-- Change installer icon on OS X, during build time -->
        <copyFile>
            <destination>${installbuilder_output_filename}/Contents/Resources/installbuilder.icns</destination>
            <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-installer/src/main/resources/installer_icon.icns</origin>
            <ruleList>
                <compareText logic="equals" text="${platform_name}" value="osx"/>
            </ruleList>
        </copyFile>
    </postBuildActionList>
    <postInstallationActionList>
        <substitute>
            <files>${installdir}/earth.properties_initial</files>
            <type>regexp</type>
            <substitutionList>
                <substitution>
                    <pattern>install_directory</pattern>
                    <value>${installdir}</value>
                </substitution>
                <substitution>
                    <pattern>INSTALLATION_LANGUAGE</pattern>
                    <value>${installation_language_code}</value>
                </substitution>
                <substitution>
                    <pattern>SEPARATE_BROWSER_SUBSTITUTE</pattern>
                    <value>true</value>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </substitution>
                <substitution>
                    <pattern>SEPARATE_BROWSER_SUBSTITUTE</pattern>
                    <value>false</value>
                    <ruleList>
                        <platformTest>
                            <negate>1</negate>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </substitution>
            </substitutionList>
        </substitute>
        <registrySet>
            <!-- Update the installed version -->
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\${project.vendor}\${project.fullName}</key>
            <name>InstallationPath</name>
            <type>REG_SZ</type>
            <value>${installdir}</value>
        </registrySet>
        <changePermissions>
            <files>${installdir}/${java_launcher_binary_name};${installdir}/*.log;${installdir}/*.properties;${installdir}/generated;${installdir}/*.db;${installdir}/*.dbSaiku</files>
            <permissions>0777</permissions>
        </changePermissions>

       
        <runProgram>
        	<abortOnError>0</abortOnError>
            <program>chown</program>
            <programArguments>-fR ${system_username}  "${installdir}/${java_launcher_binary_name}" "${installdir}/earth_error.log" "${installdir}/earth.properties" "${installdir}/generated" "${installdir}/collectEarthDatabase.db" "${installdir}/collectEarthDatabase.dbSaiku"</programArguments>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <runProgram program="chmod">
        	<abortOnError>0</abortOnError>
            <programArguments>-R ugo+rwX "${installdir}/${java_launcher_binary_name}" "${installdir}/earth_error.log" "${installdir}/earth.properties" "${installdir}/generated" "${installdir}/collectEarthDatabase.db" "${installdir}/collectEarthDatabase.dbSaiku"</programArguments>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </runProgram>
		
        
        <createSymLink>
        	<abortOnError>0</abortOnError>
            <linkName>~/Desktop/Collect Earth.app</linkName>
            <target>${installdir}/${java_launcher_binary_name}</target>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </createSymLink>
        <associateWindowsFileExtension>
        	<abortOnError>0</abortOnError>
            <extensions>.cep</extensions>
            <friendlyName>Collect Earth Project file</friendlyName>
            <icon>${installdir}\launcher_icon.ico</icon>
            <mimeType>application/vnd.openforis.collectearth</mimeType>
            <progID>openforis.collectearth.1</progID>
            <commandList>
                <!-- Defining the 'Open' command -->
                <command>
                    <makeDefault>0</makeDefault>
                    <runProgram>${installdir}\${java_launcher_binary_name}</runProgram>
                    <runProgramArguments>"%1"</runProgramArguments>
                    <verb>Open</verb>
                </command>
            </commandList>
        </associateWindowsFileExtension>
        
        <!--  Launch Collect Earth when double-clicking in cep files (Mac OS X) -->
        <!--  register the mime-type launcher -->
        <runProgram>
        	<abortOnError>0</abortOnError>
		    <program>defaults</program>
		    <programArguments>write "${installdir}/${java_launcher_binary_name}/Contents/Info" CFBundleIdentifier vnd.openforis.collectearth</programArguments>
		    <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
		</runProgram>
		<runProgram>
			<abortOnError>0</abortOnError>
		    <program>plutil</program>
		    <programArguments>-convert xml1 "${installdir}/${java_launcher_binary_name}/Contents/Info.plist" </programArguments>
		    <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
		</runProgram>

        <runProgram>
        	
        	<abortOnError>0</abortOnError>
            <program>defaults</program>
           <!-- The CDATA notation allow escaping a
            block of XML characters -->
           <programArguments>write com.apple.LaunchServices LSHandlers -array-add <![CDATA["<dict><key>LSHandlerContentTag</key>
<string>cep</string><key>LSHandlerContentTagClass</key>
<string>public.filename-extension</string><key>LSHandlerRoleAll</key>
<string>vnd.openforis.collectearth</string></dict>"
           ]]></programArguments>
           <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <!-- Restart the launch services to reload the configuration (Mac OS X)-->
        <runProgram>
        	<abortOnError>0</abortOnError>
            <program>/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister</program>
            <programArguments>-kill -domain local -domain system -domain user</programArguments>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </runProgram>
    </postInstallationActionList>
    <startMenuShortcutList>
        <startMenuShortcut>
            <comment>Uninstall ${product_fullname}</comment>
            <name>Uninstall ${product_fullname}</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon></windowsIcon>
            <windowsPath>${installdir}/</windowsPath>
        </startMenuShortcut>
        <startMenuFileShortcut>
            <comment>Collect Earth User's Manual</comment>
            <filePath>${installdir}/UserManual.pdf</filePath>
            <name>User Manual</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsIcon></windowsIcon>
        </startMenuFileShortcut>
    </startMenuShortcutList>
</component>
